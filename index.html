<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OptiLog - AI-Enhanced Maritime Reporting System</title>
    <style>
    body, html {
        margin: 0;
        padding: 0;
        height: 100%;
        font-family: Arial, sans-serif;
    }
    .container {
        display: flex;
        height: 100%;
    }
    .report-form {
        width: 70%;
        padding: 20px;
        overflow-y: auto;
    }
    .sidebar {
        width: 30%;
        display: flex;
        flex-direction: column;
        background-color: #f7f7f7;
        border-left: 1px solid #ccc;
    }
    .history-panel {
        padding: 20px;
        background-color: #e0e0e0;
        max-height: 30%;
        overflow-y: auto;
    }
    .chatbot {
        display: flex;
        flex-direction: column;
        flex-grow: 1;
    }
    .chatbot-header {
        padding: 20px;
        background-color: #d0d0d0;
    }
    .chatbot-messages {
        flex-grow: 1;
        overflow-y: auto;
        padding: 20px;
    }
    .chatbot-input {
        padding: 20px;
        border-top: 1px solid #ccc;
    }
    .form-group {
        margin-bottom: 15px;
    }
    .form-group label {
        display: block;
        margin-bottom: 5px;
    }
    .form-group input,
    .form-group textarea,
    .form-group select {
        width: 100%;
        padding: 8px;
        box-sizing: border-box;
    }
    #userInput {
        width: 100%;
        padding: 8px;
        box-sizing: border-box;
    }
</style>
</head>
<body>
    <div class="container">
        <div class="report-form">
            <h2>Maritime Report</h2>
            <div id="reportFormContainer">
                <!-- The form will be dynamically inserted here -->
            </div>
        </div>
        <div class="sidebar">
            <div class="history-panel">
                <h3>Report History</h3>
                <div id="reportHistory"></div>
            </div>
            <div class="chatbot">
                <div class="chatbot-header">
                    <h2>AI Assistant</h2>
                </div>
                <div id="chatMessages" class="chatbot-messages"></div>
                <div class="chatbot-input">
                    <input id="userInput" type="text" placeholder="Type your message and press Enter">
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
// Constants
const REPORT_TYPES = [
    "Arrival", "Departure", "Begin of offhire", "End of offhire", "Arrival STS",
    "Departure STS", "STS", "Begin canal passage", "End canal passage",
    "Begin of sea passage", "End of sea passage", "Begin Anchoring/Drifting",
    "End Anchoring/Drifting", "Noon (Position) - Sea passage", "Noon (Position) - Port",
    "Noon (Position) - River", "Noon (Position) - Stoppage", "ETA update",
    "Begin fuel change over", "End fuel change over", "Change destination (Deviation)",
    "Begin of deviation", "End of deviation", "Entering special area", "Leaving special area"
];

const TRAINING_DATA = `
You are an AI assistant for an advanced maritime reporting system, with the knowledge and experience of a seasoned maritime seafarer. Your role is to guide users through creating various types of maritime reports, ensuring compliance with industry standards and regulations while maintaining a logical sequence of events. 
Keep your responses as short and crisp and easy to understand as possible. While suggesting the reports just suggest the name of the reports not their explanations. If there is no Reports History allow user to start any report.
Valid report types: ${REPORT_TYPES.join(', ')}

Key features:
1. Error reduction and data completion assistance
2. Insights generation based on reported data
3. Streamlined reporting process
4. Enhanced accuracy in maritime operational reporting

When suggesting follow-up reports, carefully consider the history of the last 3-4 reports and the logical sequence of maritime operations. Only suggest reports from the provided list that make sense given the current context and previous reports.
`;

// Configuration
const config = {
    OPENAI_API_KEY: 'OPENAIAPIKEY' // Replace with your actual API key
};

let reportHistory = [];
let currentReportType = null;

// Function to create a simple form based on report type
function createForm(reportType) {
    const formHTML = `
        <h3>${reportType} Report</h3>
        <form id="reportForm">
            <div class="form-group">
                <label for="vesselName">Vessel Name:</label>
                <input type="text" id="vesselName" name="vesselName">
            </div>
            <div class="form-group">
                <label for="imoNumber">IMO Number:</label>
                <input type="text" id="imoNumber" name="imoNumber">
            </div>
            <div class="form-group">
                <label for="reportDetails">Report Details:</label>
                <textarea id="reportDetails" name="reportDetails" rows="4"></textarea>
            </div>
            <button type="submit">Submit Report</button>
        </form>
    `;
    document.getElementById('reportFormContainer').innerHTML = formHTML;
    
    document.getElementById('reportForm').addEventListener('submit', function(event) {
        event.preventDefault();
        alert(`${reportType} report submitted!`);
        reportHistory.push(reportType);
        updateReportHistory();
        currentReportType = null;
        document.getElementById('reportFormContainer').innerHTML = '';
    });
}

function updateReportHistory() {
    const historyHTML = reportHistory.map(report => `<div>${report}</div>`).join('');
    document.getElementById('reportHistory').innerHTML = historyHTML;
}

async function getAIResponse(userInput) {
    try {
        const response = await axios.post('https://api.openai.com/v1/chat/completions', {
            model: "gpt-3.5-turbo",
            messages: [
                { role: "system", content: TRAINING_DATA },
                { role: "user", content: userInput }
            ],
            max_tokens: 300,
            temperature: 1.0,
        }, {
            headers: {
                'Authorization': `Bearer ${config.OPENAI_API_KEY}`,
                'Content-Type': 'application/json'
            }
        });
        return response.data.choices[0].message.content;
    } catch (error) {
        console.error('Error:', error);
        return 'Sorry, there was an error processing your request.';
    }
}

const chatbotContainer = document.getElementById('chatMessages');
chatbotContainer.innerHTML = '<p>How can I assist you with maritime reporting today?</p>';

document.getElementById('userInput').addEventListener('keypress', async function(event) {
    if (event.key === 'Enter') {
        const userInput = event.target.value;
        const userMessage = `<p><strong>You:</strong> ${userInput}</p>`;
        chatbotContainer.innerHTML += userMessage;

        const responseMessage = await getAIResponse(userInput);
        const botMessage = `<p><strong>AI Assistant:</strong> ${responseMessage}</p>`;
        chatbotContainer.innerHTML += botMessage;

        // Check if a specific report type is agreed upon
        for (const reportType of REPORT_TYPES) {
            if (responseMessage.includes(`Agreed. The form for ${reportType}`)) {
                currentReportType = reportType;
                createForm(reportType);
                break;
            }
        }

        chatbotContainer.scrollTop = chatbotContainer.scrollHeight;
        event.target.value = '';
    }
});

// Initialize report history
updateReportHistory();
</script>
</body>
</html>
